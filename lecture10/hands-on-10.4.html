

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Uncertainty Propagation Through a Boundary Value Problem &#8212; Introduction to Scientific Machine Learning (Lecture Book)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture10/hands-on-10.4';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Principles of Bayesian Inference" href="../principles_of_bi.html" />
    <link rel="prev" title="Quantifying Epistemic Uncertainty in Monte Carlo Estimates" href="hands-on-10.3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">Introduction to Scientific Machine Learning (Lecture Book)</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction.html">Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture01/intro.html">Lecture 1 - Introduction to Predictive Modeling</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture01/reading-01.html">The Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture01/hands-on-01.1.html">The Uncertainty Propagation Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture01/hands-on-01.2.html">The Model Calibration Problem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../review_probability.html">Review of Probability</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture02/intro.html">Lecture 2 - Basics of Probability Theory</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture02/reading-02.html">Basics of Probability Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture02/hands-on-02.html">Experiment with “Randomness”</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture03/intro.html">Lecture 3 - Discrete Random Variables</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture03/reading-03.html">Discrete Random Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture03/hands-on-03.html">Discrete Random Variables in Python</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture04/intro.html">Lecture 4 - Continuous Random Variables</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture04/reading-04.html">Continuous Random Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture04/hands-on-04.1.html">The Uniform Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture04/hands-on-04.2.html">The Gaussian Distribution</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture05/intro.html">Lecture 5 - Collections of Random Variables</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture05/reading-05.html">Collections of Random Variables: Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture05/hands-on-05.html">Practicing with Joint Probability Mass Functions</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture06/intro.html">Lecture 6 - Random Vectors</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture06/reading-06.html">Random Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture06/hands-on-06.1.html">The Multivariate Normal - Diagonal Covariance Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture06/hands-on-06.2.html">The Multivariate Normal - Full Covariance Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture06/hands-on-06.3.html">The Multivariate Normal - Marginalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture06/hands-on-06.4.html">The Multivariate Normal - Conditioning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../uncertainty_propagation.html">Uncertainty Propagation</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture07/intro.html">Lecture 7 - Basic Sampling</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture07/hands-on-07.1.html">Pseudo-random number generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture07/hands-on-07.2.html">Sampling the uniform distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture07/hands-on-07.3.html">Sampling the categorical</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture07/hands-on-07.4.html">Sampling from continuous distributions - Inverse sampling</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture08/intro.html">Lecture 8 - The Monte Carlo Method for Estimating Expectations</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture08/reading-08.html">The Uncertainty Propagation Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture08/hands-on-08.3.html">The Monte Carlo Method for Estimating Expectations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture08/hands-on-08.4.html">Sampling Estimates of Variance</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture09/intro.html">Lecture 9 - Monte Carlo Estimates of Various Statistics</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture09/hands-on-09.1.html">Sampling Estimates of the Cumulative Distribution Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture09/hands-on-09.2.html">Sampling Estimates of the Probability Density via Histograms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture09/hands-on-09.3.html">Estimating Predictive Quantiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture09/hands-on-09.4.html">Uncertainty propagation through an ordinary differential equation</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="intro.html">Lecture 10 - Quantify Uncertainty in Monte Carlo Estimates</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="hands-on-10.1.html">Visualizing Monte Carlo Uncertainty</a></li>
<li class="toctree-l3"><a class="reference internal" href="hands-on-10.2.html">The Central Limit Theorem</a></li>
<li class="toctree-l3"><a class="reference internal" href="hands-on-10.3.html">Quantifying Epistemic Uncertainty in Monte Carlo Estimates</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Uncertainty Propagation Through a Boundary Value Problem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../principles_of_bi.html">Principles of Bayesian Inference</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture11/intro.html">Lecture 11 - Selecting Prior Information</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture11/reading-11.html">Selecting Prior Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture11/hands-on-11.1.html">Information Entropy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture11/hands-on-11.2.html">The Principle of Maximum Entropy for Discrete Random Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture11/hands-on-11.3.html">The Principle of Maximum Entropy for Continuous Random Variables</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture12/intro.html">Lecture 12 - Analytical Examples of Bayesian Inference</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture12/reading-12.html">Analytical Examples of Bayesian Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture12/hands-on-12.1.html">Bayesian Parameter Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture12/hands-on-12.2.html">Credible Intervals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture12/hands-on-12.3.html">Decision-Making</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture12/hands-on-12.4.html">Posterior Predictive Checking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../supervised_learning.html">Supervised Learning</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture13/intro.html">Lecture 13 - Linear Regression via Least Squares</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture13/reading-13.html">Linear Regression via Least Squares</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture13/hands-on-13.1.html">Linear regression with a single variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture13/hands-on-13.2.html">Polynomial Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture13/hands-on-13.3.html">The Generalized Linear Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture13/hands-on-13.4.html">Measures of Predictive Accuracy</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture14/intro.html">Lecture 14 - Bayesian Linear Regression</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture14/reading-14.html">Bayesian Linear Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture14/hands-on-14.1.html">Probabilistic Interpretation of Least Squares - Estimating the Measurement Noise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture14/hands-on-14.2.html">Maximum a Posteriori Estimate - Avoiding Overfitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture14/hands-on-14.3.html">Bayesian Linear Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture14/hands-on-14.4.html">The point-predictive Distribution - Separating Epistmic and Aleatory Uncertainty</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture15/intro.html">Lecture 15 - Advanced Topics in Bayesian Linear Regression</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture15/reading-15.html">Advanced Topics in Bayesian Linear Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture15/hands-on-15.1.html">Evidence approximation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture15/hands-on-15.2.html">Automatic Relevance Determination</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture15/hands-on-15.3.html">Diagnostics for Posterior Predictive</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture16/intro.html">Lecture 16 - Classification</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture16/reading-16.html">Theoretical Background on Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture16/hands-on-16.1.html">Logistic regression with one variable (High melting explosives)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture16/hands-on-16.2.html">Logistic Regression with Many Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture16/hands-on-16.3.html">Decision making</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture16/hands-on-16.4.html">Diagnostics for Classifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture16/hands-on-16.5.html">Multi-class Logistic Regression</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../unsupervised_learning.html">Unsupervised Learning</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture17/intro.html">Lecture 17 - Clustering and Density Estimation</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture17/reading-17.html">Unsupervised Learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture17/hands-on-17.1.html">Clustering using k-means</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture17/hands-on-17.2.html">Density Estimation via Gaussian mixtures</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture18/intro.html">Lecture 18 - Dimensionality Reduction</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture18/reading-18.html">Dimensionality Reduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture18/hands-on-18.1.html">Dimensionality Reduction Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture18/hands-on-18.2.html">Clustering High-dimensional Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture18/hands-on-18.3.html">Density Estimation with High-dimensional Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../state_space_models.html">State Space Models</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-25"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture19/intro.html">Lecture 19 - State Space Models - Filtering Basics</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-26"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture19/reading-19.html">State Space Models - Filtering Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture19/hands-on-19.1.html">Object Tracking Example</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture20/intro.html">Lecture 20 - State Space Models - Kalman Filters</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-27"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture20/reading-20.html">State Space Models - Kalman Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture20/hands-on-20.1.html">Kalman Filter for Object Tracking Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../gaussian_process_regression.html">Gaussian Process Regression</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-28"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture21/intro.html">Lecture 21 - Gaussian Process Regression: Priors on Function Spaces</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-29"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture21/reading-21.html">Gaussian Process Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture21/hands-on-21.html">Example: Priors on function spaces</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture22/intro.html">Lecture 22 - Gaussian Process Regression: Conditioning on Data</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-30"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture22/reading-22.html">Gaussian Process Regression - Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture22/hands-on-22.1.html">Gaussian Process Regression Without Noise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture22/hands-on-22.2.html">Gaussian Process Regression with Noise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture22/hands-on-22.3.html">Tuning the Hyperparameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture22/hands-on-22.4.html">Multivariate Gaussian Process Regression</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture23/intro.html">Lecture 23 - Bayesian Global Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-31"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture23/reading-23.html">Bayesian Global Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture23/hands-on-23.1.html">Maximum Mean - A Bad Information Acquisition Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture23/hands-on-23.2.html">Maximum Upper Interval</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture23/hands-on-23.3.html">Probability of Improvement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture23/hands-on-23.4.html">Expected Improvement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture23/hands-on-23.5.html">Expected Improvement - With Observation Noise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture23/hands-on-23.6.html">Quantifying Epistemic Uncertainty about the Solution of the Optimization problem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../neural_networks.html">Neural Networks</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-32"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture24/intro.html">Lecture 24 - Deep Neural Networks</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-33"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture24/reading-24.html">Deep Neural Networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture24/hands-on-24.html">Regression with Deep Neural Networks</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture25/intro.html">Lecture 25 - Deep Neural Networks Continued</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-34"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture25/reading-25.html">Deep Neural Networks Continued</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture25/hands-on-25.html">Classification with Deep Neural Networks</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture26/intro.html">Lecture 26 - Physics-informed Deep Neural Networks</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-35"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture26/reading-26.html">Physics-informed Deep Neural Networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture26/hands-on-26.1.html">Physics-informed regularization: Solving ODEs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture26/hands-on-26.2.html">Physics-informed regularization: Solving PDEs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced_methods.html">Advanced Methods for Characterizing Posteriors</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-36"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture27/intro.html">Lecture 27 - Sampling Methods</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-37"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture27/reading-27.html">Sampling Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture27/hands-on-27.1.html">Probabilistic programming with <code class="docutils literal notranslate"><span class="pre">PyMC3</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture27/hands-on-27.2.html">Sampling From the Distributions With Random Walk Metropolis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture27/hands-on-27.3.html">The Metropolis-Hastings Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture27/hands-on-27.4.html">Gibbs Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture27/hands-on-27.5.html">Sequential Monte Carlo</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../lecture28/intro.html">Lecture 28 - Variational Inference</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-38"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../lecture28/reading-28.html">Variational Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lecture28/hands-on-28.html">Variational Inference Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../homework/intro.html">Homework</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-39"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../homework/homework-01.html">Homework 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/homework-02.html">Homework 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/homework-03.html">Homework 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/homework-04.html">Homework 4</a></li>



<li class="toctree-l2"><a class="reference internal" href="../homework/homework-05.html">Homework 5</a></li>



<li class="toctree-l2"><a class="reference internal" href="../homework/homework-06.html">Homework 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/homework-07.html">Homework 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/homework-08.html">Homework 8</a></li>












</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/PredictiveScienceLab/data-analytics-se/blob/master/lecturebook/lecture10/hands-on-10.4.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lecture10/hands-on-10.4.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Uncertainty Propagation Through a Boundary Value Problem</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modeling-our-state-of-knowledge-about-the-conductivity-of-the-rod">Modeling our state of knowledge about the conductivity of the rod</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-a-bit-organized-using-python-classes">Getting a bit organized using Python classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-propagation-through-the-boundary-value-problem">Uncertainty propagation through the boundary value problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib_inline</span>
<span class="n">matplotlib_inline</span><span class="o">.</span><span class="n">backend_inline</span><span class="o">.</span><span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;ticks&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="uncertainty-propagation-through-a-boundary-value-problem">
<span id="uncertainty-propagation-through-a-bvp"></span><h1>Uncertainty Propagation Through a Boundary Value Problem<a class="headerlink" href="#uncertainty-propagation-through-a-boundary-value-problem" title="Permalink to this heading">#</a></h1>
<p>Consider the steady-state heat equation on a heterogeneous rod with no heat sources:</p>
<div class="math notranslate nohighlight">
\[
\frac{d}{dx}\left(c(x)\frac{d}{dx}T(x)\right) = 0,
\]</div>
<p>for <span class="math notranslate nohighlight">\(x\)</span> between <span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(1\text{m}\)</span> and boundary values:</p>
<div class="math notranslate nohighlight">
\[
T(0) = 400^\circ\text{C}\;\text{and}\;T(x=1\text{m}) = 4^\circ\text{C}.
\]</div>
<p>We are interested in cases in which we are uncertain about the conductivity, <span class="math notranslate nohighlight">\(c(x)\)</span>.
Let’s work on modeling this uncertainty in the first place.</p>
<section id="modeling-our-state-of-knowledge-about-the-conductivity-of-the-rod">
<h2>Modeling our state of knowledge about the conductivity of the rod<a class="headerlink" href="#modeling-our-state-of-knowledge-about-the-conductivity-of-the-rod" title="Permalink to this heading">#</a></h2>
<p>We need to come up with <span class="math notranslate nohighlight">\(c(x)\)</span>. The first thing we need to do is write down everything we know about the rod:</p>
<ul class="simple">
<li><p>The rod is one meter long. That is, we are ignoring the possibility of an uncertain length.</p></li>
<li><p>The rod is from laminations of <span class="math notranslate nohighlight">\(2\)</span> different materials: fiberglass (labeled material 0) and steel (labeled material 1).</p></li>
<li><p>We know that the concentration of fiberglass and steel are <span class="math notranslate nohighlight">\(0.3\)</span> and <span class="math notranslate nohighlight">\(0.7\)</span>, respectively.</p></li>
<li><p>We know that the thermal conductivity of the fiberglass <span class="math notranslate nohighlight">\(0.045\;\text{Wm}^{-1}\text{K}^{-1}\)</span> and of the second <span class="math notranslate nohighlight">\(38\;\text{Wm}^{-1}\text{K}^{-1}\)</span>.</p></li>
<li><p>The rod is made out of <span class="math notranslate nohighlight">\(D\)</span> segments, each consisting of only one of the two types of material. Even though we do not know the exact number of elements <span class="math notranslate nohighlight">\(D\)</span>, we expect them to be around <span class="math notranslate nohighlight">\(100\)</span>.</p></li>
</ul>
<p>Let’s turn this information into a mathematical model for the conductivity of the rod.
First, the number of segments <span class="math notranslate nohighlight">\(D\)</span> must be a discrete random variable with a given expectation, <span class="math notranslate nohighlight">\(\mathbb{E}[D] = 100\)</span>.
The best choice is a Poisson random variable with the correct rate parameter.
It is:</p>
<div class="math notranslate nohighlight">
\[
D \sim \operatorname{Poisson}(100).
\]</div>
<p>Let’s plot its pmf to build some intuition about it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>

<span class="n">D</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="n">D</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$d$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$p(D=d)$&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8a72e8b16b7c5a504d34d29483bb8b03cdb66bf122064bedf370dc11ded49bc4.svg" src="../_images/8a72e8b16b7c5a504d34d29483bb8b03cdb66bf122064bedf370dc11ded49bc4.svg" /></div>
</div>
<p>This looks reasonable. Let’s move to the segment coordinates.
The coordinates of these segments are also random.
Specifically, the leftmost coordinate is just <span class="math notranslate nohighlight">\(X_0 = 0\)</span>; the right-most is <span class="math notranslate nohighlight">\(X_D = 1\)</span>.
We know this because we know the total length.
What are the intermediate <span class="math notranslate nohighlight">\(D-1\)</span> coordinates?
Since we are not told anything else, let’s assume that these intermediate coordinates are generated by uniformly sampling in <span class="math notranslate nohighlight">\([0,1]\)</span> and then sorting the numbers.
Mathematically, the random vector <span class="math notranslate nohighlight">\(X_{1:D-1}\)</span> is given by:</p>
<div class="math notranslate nohighlight">
\[
(X_1,\dots, X_{D-1}) = \operatorname{sort}(U_1,\dots,U_{D-1}),
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
U_i \sim U([0,1]).
\]</div>
<p>Let’s visualize this as well to develop our intuition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create some random rod segments</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># Get the number of segments</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
    <span class="c1"># Get the intermediate coordinates</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Create the coordinates of the segment in a sorted manner (including the end points)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]])</span>
    <span class="c1"># Plot the segment locations</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span>
        <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Rod </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4166060f6b52c1019dd671e3485d6a344ce53af53aca99afce17bfc539fe6ddf.svg" src="../_images/4166060f6b52c1019dd671e3485d6a344ce53af53aca99afce17bfc539fe6ddf.svg" /></div>
</div>
<p>Okay, this looks reasonable as well.
Let’s move on to the material types.
Each segment will be assigned a random material.
Say that the material we assign to segment <span class="math notranslate nohighlight">\(d\)</span> is <span class="math notranslate nohighlight">\(M_d\)</span> taking values in <span class="math notranslate nohighlight">\(\{0, 1\}\)</span>.
What distribution should we assign to the <span class="math notranslate nohighlight">\(M_d\)</span>’s?
We expect the concentration of material <span class="math notranslate nohighlight">\(0\)</span> to be <span class="math notranslate nohighlight">\(0.3\)</span> and of material <span class="math notranslate nohighlight">\(1\)</span> to be <span class="math notranslate nohighlight">\(0.7\)</span>.
We can interpret this information as the statement that:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^D1_{\{0\}}(X_d)\right] = 0.3,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^D1_{\{1\}}(X_d)\right] = 0.7.
\]</div>
<p>These equations say that the expected percentage of material <span class="math notranslate nohighlight">\(0\)</span> is <span class="math notranslate nohighlight">\(0.3\)</span> and similarly for material <span class="math notranslate nohighlight">\(1\)</span>.
What distribution for <span class="math notranslate nohighlight">\(M_d\)</span> is compatible with this information?
Let’s assume that all the <span class="math notranslate nohighlight">\(M_d\)</span>’s are independent and identically distributed conditioned on <span class="math notranslate nohighlight">\(D\)</span>.
Then we can write:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^D1_{\{0\}}(M_d)\right] = \mathbb{E}\left[\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^D1_{\{0\}}(M_d)|D\right]\right],
\]</div>
<p>where the internal expectation is conditional on <span class="math notranslate nohighlight">\(D\)</span>, i.e., it is with respect to <span class="math notranslate nohighlight">\(p(M_1,\dots,M_D|D)\)</span>.
So, in this internal expectation, you can treat <span class="math notranslate nohighlight">\(D\)</span> as constant and simplify the equation as:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}\left[\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^D1_{\{0\}}(M_d)|D\right]\right] = 
\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^D\mathbb{E}\left[1_{\{0\}}(M_d)|D\right]\right].
\]</div>
<p>Now because the <span class="math notranslate nohighlight">\(X_d\)</span>’s are identically distributed conditioned on <span class="math notranslate nohighlight">\(D\)</span>, the internal expectation is simply the conditional probability of <span class="math notranslate nohighlight">\(X_d\)</span> taking the value <span class="math notranslate nohighlight">\(0\)</span>, i.e., we can rewrite it as:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^D\mathbb{E}\left[1_{\{0\}}(M_d)|D\right]\right]
= 
\mathbb{E}\left[\frac{1}{D}\sum_{d=1}^Dp(M_d = 0|D)\right].
\]</div>
<p>So, we will satisfy the initial equation if we take <span class="math notranslate nohighlight">\(p(M_d = 0|D) = 0.3\)</span> independently of what <span class="math notranslate nohighlight">\(D\)</span> is.
Let’s do exactly that. This means that we can take the <span class="math notranslate nohighlight">\(M_d\)</span> to follow Categorical distributions:</p>
<div class="math notranslate nohighlight">
\[
M_d \sim \operatorname{Categorical}(0.3, 0.7),
\]</div>
<p>for <span class="math notranslate nohighlight">\(d=1,\dots,D\)</span>.</p>
<p>Okay, now we have created random variables that model the number of segments and the material we have on each piece. How do we combine this to make the thermal conductivity a random function?
Well, this is now simple. When we want the thermal conductivity at location <span class="math notranslate nohighlight">\(x\)</span>, all we have to do is to find the segment <span class="math notranslate nohighlight">\(d\)</span> containing <span class="math notranslate nohighlight">\(x\)</span> and look up the conductivity of material type <span class="math notranslate nohighlight">\(M_d\)</span>.
If the conductivity of the material <span class="math notranslate nohighlight">\(0\)</span> is <span class="math notranslate nohighlight">\(c_0 = 0.3\)</span> and that of material <span class="math notranslate nohighlight">\(1\)</span> is <span class="math notranslate nohighlight">\(c_1 = 0.8\)</span>, then we can write this function as:</p>
<div class="math notranslate nohighlight">
\[
c(x) = \sum_{d=1}^Dc_{M_d}1_{[X_{d-1},X_{d}]}(x).
\]</div>
<p>Notice that the conductivity is a function of <span class="math notranslate nohighlight">\(D\)</span> and the <span class="math notranslate nohighlight">\(X_d\)</span>’s and the <span class="math notranslate nohighlight">\(M_d\)</span>’s.
So, it is a random function.</p>
</section>
<section id="getting-a-bit-organized-using-python-classes">
<h2>Getting a bit organized using Python classes<a class="headerlink" href="#getting-a-bit-organized-using-python-classes" title="Permalink to this heading">#</a></h2>
<p>The model we put together for the rod conductivity needs to be simplified.
Let me repeat it here for clarity.
It is as follows.
The number of segments is:</p>
<div class="math notranslate nohighlight">
\[
D\sim \operatorname{Poisson}(100).
\]</div>
<p>The <span class="math notranslate nohighlight">\(D+1\)</span> segment coordinates <span class="math notranslate nohighlight">\(X_0,\dots,X_D\)</span> are:</p>
<div class="math notranslate nohighlight">
\[
X_0 = 0,
\]</div>
<div class="math notranslate nohighlight">
\[
X_D = 1,
\]</div>
<p>and the intermediate segment coordinates are:</p>
<div class="math notranslate nohighlight">
\[
(X_1,\dots, X_{D-1}) = \operatorname{sort}(U_1,\dots,U_{D-1}),
\]</div>
<p>where the segment coordinates are uniformly sampled:</p>
<div class="math notranslate nohighlight">
\[
U_i \sim U([0,1]),
\]</div>
<p>for <span class="math notranslate nohighlight">\(i=1,\dots,D-1\)</span>.
Finally, the material types are</p>
<div class="math notranslate nohighlight">
\[
M_d \sim \operatorname{Categorical}(0.3, 0.7),
\]</div>
<p>for <span class="math notranslate nohighlight">\(d=1,\dots,D\)</span>, and the random thermal conductivity function:</p>
<div class="math notranslate nohighlight">
\[
c(x) = \sum_{d=1}^Dc_{M_d}1_{[X_{d-1},X_{d}]}(x).
\]</div>
<p>This is a lot to keep track of.
We want to group everything so that we minimize the possibility of bugs.
We are going to achieve this using Python classes. If you want to learn what classes are, you may want to pause at this point and watch this <a class="reference external" href="https://youtu.be/wfcWRAxRVBA">tutorial video</a>. Otherwise, skip the definition and go to the end, where we use them.</p>
<p>We will make two classes, a <code class="docutils literal notranslate"><span class="pre">Rod</span></code> and a <code class="docutils literal notranslate"><span class="pre">RandomRod</span></code>. Their descriptions are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Rod</span></code> represents a specific rod, a rod sample if you like. We will be able to initialize it using the segment coordinates, the material ids that go in each segment, and the thermal conductivity that comes with each material. This class will have the following methods:</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Rod.get_conductivity(x)</span></code> will give us the thermal conductivity of the specimen at location <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Rod.__repr__()</span></code> will return a text representation of the specimen. This function will be used when you try to <code class="docutils literal notranslate"><span class="pre">print</span></code> a rod.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Rod.plot()</span></code> will be a function that visualizes the rod.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RandomRod</span></code> represents a … random rod. It collects all the random variables that affect the characteristics of the rod. Hence, it needs to know the rate of the Poisson distribution for <span class="math notranslate nohighlight">\( D \)</span>, the concentration of each material, and, of course, the thermal conductivity associated with each material. This class will have the following methods:</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RandomRod.rvs()</span></code> will be a function that samples a random <code class="docutils literal notranslate"><span class="pre">Rod</span></code>.</p></li>
</ul>
<p>Okay, let’s do it. First, the <code class="docutils literal notranslate"><span class="pre">Rod</span></code>. You can skip the class definition and go directly to the code block where we use it.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>

<span class="k">class</span> <span class="nc">Rod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class representing a rod made out of different materials.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">    segment_coords -- Coordinates of the segments (both left and right). Total N + 1</span>
<span class="sd">                      if segments are N.</span>
<span class="sd">    mat_id         -- The material ids on each segment. Total N. Values must start</span>
<span class="sd">                      at 0 and go sequential to the maximum number of materials</span>
<span class="sd">                      we have on the rod.</span>
<span class="sd">    mat_cond       -- The conductivity associated with each unique material id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_coords</span><span class="p">,</span>
        <span class="n">mat_id</span><span class="p">,</span>
        <span class="n">mat_cond</span>
    <span class="p">):</span>
        <span class="c1"># Save segments for later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">segment_coords</span><span class="p">)</span>
        <span class="c1"># The total number of segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># Save the material id on each segment for later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_id</span> <span class="o">=</span> <span class="n">mat_id</span>
        <span class="c1"># The number of unique materials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_mat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_id</span><span class="p">))</span>
        <span class="c1"># The conductivity on each segment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mat_cond</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mat_id</span><span class="p">])</span>
        
    <span class="k">def</span> <span class="nf">_get_conductivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the conductivity at location x, assuming x is a scalar.&quot;&quot;&quot;</span>
        <span class="c1"># Find the segment that contains x</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_cond</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
    <span class="k">def</span> <span class="nf">get_conductivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the conductivity at location x. </span>
<span class="sd">        </span>
<span class="sd">        This works when x is a scalar or a numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_conductivity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># This checks if x is a numpy array. The function will fail other wise.</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="c1"># And it will only work with 1D arrays</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="c1"># This evaluates the conductivity at all the elements of x and returns</span>
        <span class="c1"># a numpy array</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_conductivity</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a string representation of the rod.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;SEGID</span><span class="se">\t</span><span class="s1">Left</span><span class="se">\t</span><span class="s1">Right</span><span class="se">\t</span><span class="s1">Mat.</span><span class="se">\t</span><span class="s1">Cond.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">37</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">segment_coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">segment_coords</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">material_on_each_segment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">segment_cond</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">s</span>
    
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the bar. Returns the axes object on which the rod is plot.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">        ax -- An axes object to plot on. If not given, a new one will be created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span><span class="p">):</span>
            <span class="n">mat_segment</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_coords</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_id</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mat_segment</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Let’s play with this class for a little bit by generating a random material:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">Rod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on class Rod in module __main__:

class Rod(builtins.object)
 |  Rod(segment_coords, mat_id, mat_cond)
 |  
 |  A class representing a rod made out of different materials.
 |  
 |  Arguments:
 |  segment_coords -- Coordinates of the segments (both left and right). Total N + 1
 |                    if segments are N.
 |  mat_id         -- The material ids on each segment. Total N. Values must start
 |                    at 0 and go sequential to the maximum number of materials
 |                    we have on the rod.
 |  mat_cond       -- The conductivity associated with each unique material id.
 |  
 |  Methods defined here:
 |  
 |  __init__(self, segment_coords, mat_id, mat_cond)
 |      Initialize self.  See help(type(self)) for accurate signature.
 |  
 |  __repr__(self)
 |      Get a string representation of the rod.
 |  
 |  get_conductivity(self, x)
 |      Evaluate the conductivity at location x. 
 |      
 |      This works when x is a scalar or a numpy array.
 |  
 |  plot(self, ax=None)
 |      Plots the bar. Returns the axes object on which the rod is plot.
 |      
 |      Arguments:
 |      ax -- An axes object to plot on. If not given, a new one will be created.
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
</pre></div>
</div>
</div>
</div>
<p>So this just shows the text that we put inside tripple quotes.
Let’s make a rod.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s take two materials with conductivities:</span>
<span class="n">material_cond</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>
<span class="c1"># The number of materials we have:</span>
<span class="n">num_materials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">material_cond</span><span class="p">)</span>
<span class="c1"># The number of segments we want to have</span>
<span class="n">num_segments</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># The segment coordinates. First segment starts at zero. The last ends at one.</span>
<span class="c1"># The intermediate segments have random locations.</span>
<span class="n">segment_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="c1"># Now let&#39;s sample a different conductivity for each segment</span>
<span class="n">material_on_each_segment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">num_materials</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_segments</span><span class="p">)</span>
<span class="c1"># Conductivity on each segment</span>
<span class="n">segment_cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">material_cond</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">material_on_each_segment</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="c1"># Now create the rod object:</span>
<span class="n">rod</span> <span class="o">=</span> <span class="n">Rod</span><span class="p">(</span>
    <span class="n">segment_coords</span><span class="p">,</span>
    <span class="n">material_on_each_segment</span><span class="p">,</span>
    <span class="n">material_cond</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can evaluate the rod object at point to get the conductivity:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rod</span><span class="o">.</span><span class="n">get_conductivity</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8
</pre></div>
</div>
</div>
</div>
<p>Or you can print it to see how it looks like:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">rod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SEGID	Left	Right	Mat.	Cond.
-------------------------------------
 0	0.00	0.00	1	0.80
 1	0.00	0.00	1	0.80
 2	0.00	0.00	0	0.30
 3	0.00	0.01	0	0.30
 4	0.01	0.01	1	0.80
 5	0.01	0.02	0	0.30
 6	0.02	0.03	1	0.80
 7	0.03	0.05	0	0.30
 8	0.05	0.06	0	0.30
 9	0.06	0.07	0	0.30
 10	0.07	0.08	1	0.80
 11	0.08	0.08	1	0.80
 12	0.08	0.10	1	0.80
 13	0.10	0.10	1	0.80
 14	0.10	0.10	0	0.30
 15	0.10	0.10	0	0.30
 16	0.10	0.13	0	0.30
 17	0.13	0.13	1	0.80
 18	0.13	0.13	0	0.30
 19	0.13	0.15	0	0.30
 20	0.15	0.16	0	0.30
 21	0.16	0.16	1	0.80
 22	0.16	0.17	0	0.30
 23	0.17	0.22	0	0.30
 24	0.22	0.22	1	0.80
 25	0.22	0.23	0	0.30
 26	0.23	0.24	0	0.30
 27	0.24	0.24	1	0.80
 28	0.24	0.24	1	0.80
 29	0.24	0.26	0	0.30
 30	0.26	0.27	1	0.80
 31	0.27	0.27	1	0.80
 32	0.27	0.27	0	0.30
 33	0.27	0.30	1	0.80
 34	0.30	0.31	0	0.30
 35	0.31	0.32	0	0.30
 36	0.32	0.32	0	0.30
 37	0.32	0.33	1	0.80
 38	0.33	0.33	0	0.30
 39	0.33	0.36	0	0.30
 40	0.36	0.37	0	0.30
 41	0.37	0.37	0	0.30
 42	0.37	0.38	1	0.80
 43	0.38	0.39	1	0.80
 44	0.39	0.40	1	0.80
 45	0.40	0.41	0	0.30
 46	0.41	0.43	0	0.30
 47	0.43	0.44	1	0.80
 48	0.44	0.44	0	0.30
 49	0.44	0.46	1	0.80
 50	0.46	0.46	0	0.30
 51	0.46	0.48	0	0.30
 52	0.48	0.48	1	0.80
 53	0.48	0.49	0	0.30
 54	0.49	0.49	0	0.30
 55	0.49	0.50	0	0.30
 56	0.50	0.53	0	0.30
 57	0.53	0.54	1	0.80
 58	0.54	0.54	0	0.30
 59	0.54	0.55	0	0.30
 60	0.55	0.55	0	0.30
 61	0.55	0.56	1	0.80
 62	0.56	0.56	0	0.30
 63	0.56	0.57	1	0.80
 64	0.57	0.57	0	0.30
 65	0.57	0.58	0	0.30
 66	0.58	0.59	1	0.80
 67	0.59	0.62	1	0.80
 68	0.62	0.62	1	0.80
 69	0.62	0.64	0	0.30
 70	0.64	0.64	0	0.30
 71	0.64	0.65	0	0.30
 72	0.65	0.66	1	0.80
 73	0.66	0.71	1	0.80
 74	0.71	0.73	1	0.80
 75	0.73	0.74	1	0.80
 76	0.74	0.75	0	0.30
 77	0.75	0.76	0	0.30
 78	0.76	0.76	0	0.30
 79	0.76	0.76	0	0.30
 80	0.76	0.77	0	0.30
 81	0.77	0.79	0	0.30
 82	0.79	0.79	0	0.30
 83	0.79	0.79	0	0.30
 84	0.79	0.81	1	0.80
 85	0.81	0.83	1	0.80
 86	0.83	0.83	0	0.30
 87	0.83	0.84	0	0.30
 88	0.84	0.86	1	0.80
 89	0.86	0.88	0	0.30
 90	0.88	0.88	1	0.80
 91	0.88	0.88	1	0.80
 92	0.88	0.91	0	0.30
 93	0.91	0.91	1	0.80
 94	0.91	0.91	0	0.30
 95	0.91	0.92	0	0.30
 96	0.92	0.93	1	0.80
 97	0.93	0.96	1	0.80
 98	0.96	0.97	1	0.80
 99	0.97	1.00	0	0.30
</pre></div>
</div>
</div>
</details>
</div>
<p>Or you can plot it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">rod</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/17e60ebb739fff75a1e3d205d6ba6c96d284a4e915c3722d22e2ce4aa1209c04.svg" src="../_images/17e60ebb739fff75a1e3d205d6ba6c96d284a4e915c3722d22e2ce4aa1209c04.svg" /></div>
</div>
<p>Now, let’s make the <code class="docutils literal notranslate"><span class="pre">RandomRod</span></code> class:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RandomRod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class modeling a random rod.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">    av_num_segments -- The ``rate`` of the Poisson distribution giving</span>
<span class="sd">                       the number of segments.</span>
<span class="sd">    mat_probs       -- The probabilities of the categorical specifying</span>
<span class="sd">                       each material goes on each segment.</span>
<span class="sd">    mat_cond        -- The conductivity associaed with each unique material id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">av_num_segments</span><span class="p">,</span> <span class="n">mat_probs</span><span class="p">,</span> <span class="n">mat_cond</span><span class="p">):</span>
        <span class="c1"># Save some info internally for later usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">av_num_segments</span> <span class="o">=</span> <span class="n">av_num_segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_probs</span> <span class="o">=</span> <span class="n">mat_probs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_cond</span> <span class="o">=</span> <span class="n">mat_cond</span>
        <span class="c1"># Make the Poisson variable corresponding to the number of segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">av_num_segments</span><span class="p">)</span>
        <span class="c1"># Make the Uniform giving the location of the segment coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
        <span class="c1"># Make the Categorical random variable that allows us to pick the material</span>
        <span class="c1"># id on each segment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">rv_discrete</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mat_probs</span><span class="p">)),</span> <span class="n">mat_probs</span><span class="p">)</span>
        <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a single random rod.&quot;&quot;&quot;</span>
        <span class="c1"># Draw the number of segments</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
        <span class="c1"># Draw the coordinates</span>
        <span class="n">segment_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Draw the material type on each segment</span>
        <span class="n">mat_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        <span class="c1"># Generate the rod</span>
        <span class="k">return</span> <span class="n">Rod</span><span class="p">(</span>
            <span class="n">segment_coords</span><span class="p">,</span>
            <span class="n">mat_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat_cond</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate many random rods.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Let’s initialize it:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the random rod object</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">RandomRod</span><span class="p">(</span>
    <span class="mi">100</span><span class="p">,</span>          <span class="c1"># The number of segments</span>
    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>   <span class="c1"># The concentration of each material</span>
    <span class="p">[</span><span class="mf">0.045</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">]</span> <span class="c1"># The thermal conductivity of each material</span>
<span class="p">)</span>  
<span class="c1"># Let&#39;s sample a few of them and plot them</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">R</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/38b9fb51ba6682d3187e44ed63cf4fd782845f8005d9038f1bd827fbf17dec8e.svg" src="../_images/38b9fb51ba6682d3187e44ed63cf4fd782845f8005d9038f1bd827fbf17dec8e.svg" /><img alt="../_images/9ec76b8d8acab9dd492fcf3ef83e21391890620a801353335b391e2e5f46772f.svg" src="../_images/9ec76b8d8acab9dd492fcf3ef83e21391890620a801353335b391e2e5f46772f.svg" /><img alt="../_images/045bb6444a1e692a31688a5c7e410a5dfeac65137f432c3ad13d863c5b543806.svg" src="../_images/045bb6444a1e692a31688a5c7e410a5dfeac65137f432c3ad13d863c5b543806.svg" /><img alt="../_images/617b7113202d6bb0bb0e27a81c186fcf6275ec249c254002d186acee2df6ed83.svg" src="../_images/617b7113202d6bb0bb0e27a81c186fcf6275ec249c254002d186acee2df6ed83.svg" /><img alt="../_images/3266cfa68694756d2f60acea20213701a21ca641521a852db1f40f2de20e3604.svg" src="../_images/3266cfa68694756d2f60acea20213701a21ca641521a852db1f40f2de20e3604.svg" /></div>
</details>
</div>
<p>Now that we can generate random rods let’s write a solver for the steady-state heat equation.
The numerical solver will also be a class that takes a given rod and solves the problem.</p>
<p><a class="reference external" href="https://www.ctcms.nist.gov/fipy/">Fipy</a> is used to solve the boundary value problem using a finite volume scheme
You may have to install it if you don’t have it using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RUN THIS BLOCK IF YOU HAVEN&#39;T INSTALLED fipy yet</span>
<span class="o">!</span>pip3<span class="w"> </span>install<span class="w"> </span>fipy
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">DEPRECATION: Loading egg at /opt/homebrew/lib/python3.11/site-packages/ipython_tikzmagic-0.1.1-py3.11.egg is deprecated. pip 23.3 will enforce this behaviour change. A possible replacement is to use pip for package installation..</span>
Collecting fipy
  Obtaining dependency information for fipy from https://files.pythonhosted.org/packages/3c/90/35015c5e45573144c8c05fc4ce559316205b128eb32fa8126f16f6deb6ea/FiPy-3.4.4-py3-none-any.whl.metadata
  Downloading FiPy-3.4.4-py3-none-any.whl.metadata (1.8 kB)
Requirement already satisfied: numpy in /opt/homebrew/lib/python3.11/site-packages (from fipy) (1.24.3)
Requirement already satisfied: scipy in /opt/homebrew/lib/python3.11/site-packages (from fipy) (1.10.1)
Requirement already satisfied: matplotlib in /opt/homebrew/lib/python3.11/site-packages (from fipy) (3.7.1)
Collecting future (from fipy)
  Downloading future-0.18.3.tar.gz (840 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">840.9/840.9 kB</span> <span class=" -Color -Color-Red">1.0 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>a <span class=" -Color -Color-Cyan">0:00:01</span>
?25h  Preparing metadata (setup.py) ... ?25ldone
?25hRequirement already satisfied: contourpy&gt;=1.0.1 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (1.0.7)
Requirement already satisfied: cycler&gt;=0.10 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (0.11.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (4.39.4)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (1.4.4)
Requirement already satisfied: packaging&gt;=20.0 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (23.1)
Requirement already satisfied: pillow&gt;=6.2.0 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (9.5.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (3.0.9)
Requirement already satisfied: python-dateutil&gt;=2.7 in /opt/homebrew/lib/python3.11/site-packages (from matplotlib-&gt;fipy) (2.8.2)
Requirement already satisfied: six&gt;=1.5 in /opt/homebrew/lib/python3.11/site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib-&gt;fipy) (1.16.0)
Downloading FiPy-3.4.4-py3-none-any.whl (443 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">443.6/443.6 kB</span> <span class=" -Color -Color-Red">1.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>00:0100:01
?25hBuilding wheels for collected packages: future
  Building wheel for future (setup.py) ... ?25ldone
?25h  Created wheel for future: filename=future-0.18.3-py3-none-any.whl size=492022 sha256=ab00cb2c2686e1ed87c348ca138447f55faa536b67f27727a970a5b2d5210282
  Stored in directory: /Users/ibilion/Library/Caches/pip/wheels/da/19/ca/9d8c44cd311a955509d7e13da3f0bea42400c469ef825b580b
Successfully built future
Installing collected packages: future, fipy
Successfully installed fipy-3.4.4 future-0.18.3
</pre></div>
</div>
</div>
</div>
<p>Here is our solver using Fipy:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fipy</span>

<span class="k">class</span> <span class="nc">SteadyStateHeat1DSolver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solves the 1D steady state heat equation with dirichlet boundary conditions.</span>
<span class="sd">    It uses the stochastic model we developed above to define the random conductivity.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">    nx          -- Number of grid points</span>
<span class="sd">    value_left  -- The value at the left side of the boundary.</span>
<span class="sd">    value_right -- The value at the right side of the boundary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nx</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">value_left</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
        <span class="n">value_right</span><span class="o">=</span><span class="mf">4.0</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">nx</span>
        <span class="c1"># A computational mesh with nx elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">fipy</span><span class="o">.</span><span class="n">Grid1D</span><span class="p">(</span>
            <span class="n">nx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span>
            <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="p">)</span>
        <span class="c1"># A variable that represents that temperature on the mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">fipy</span><span class="o">.</span><span class="n">CellVariable</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;$T(x)$&#39;</span><span class="p">,</span>
            <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mf">0.</span>
        <span class="p">)</span>
        <span class="c1"># A variable that represents the thermal conductivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">fipy</span><span class="o">.</span><span class="n">FaceVariable</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;$C(x)$&#39;</span><span class="p">,</span>
            <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.</span>
        <span class="p">)</span>
        <span class="c1"># The constrain on the left boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="n">value_left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">facesLeft</span><span class="p">)</span>
        <span class="c1"># The constrain on the right boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="n">value_right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">facesRight</span><span class="p">)</span>
        <span class="c1"># The The diffusion term</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eq</span> <span class="o">=</span> <span class="n">fipy</span><span class="o">.</span><span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rod</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluates the code at a specific xi.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find the values of the mesh points</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faceCenters</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="c1"># Evaluate the conductivity on these points using the rod model</span>
        <span class="n">cond_val</span> <span class="o">=</span> <span class="n">rod</span><span class="o">.</span><span class="n">get_conductivity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># Update conductivity values in the equation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">cond_val</span><span class="p">)</span>
        <span class="c1"># Solve the equation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="c1"># Return the solution</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">faceValue</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Let’s draw some random rods and plot the temperature profile for each one of them</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">SteadyStateHeat1DSolver</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">rod</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">rod</span><span class="p">)</span>
    <span class="c1"># plot the rod</span>
    <span class="n">rod</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># Get rid of the y ticks for the rod</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="c1"># Get another axis to plot the temperature</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="c1"># Make sure the ticks for this axis are on the left</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
    <span class="c1"># Same for the label</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="c1"># Plot the temperature</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ (m)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T(x)\;(^\circ C)$&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/eed373e9aba9634e84db6f58bf13a34e73bc5da8e87fd6785f09a0f852c64caa.svg" src="../_images/eed373e9aba9634e84db6f58bf13a34e73bc5da8e87fd6785f09a0f852c64caa.svg" /><img alt="../_images/f1bc2e30cd9e2ea8d2025fd2e410ee96061841d2966a6ef9169c416cca5d662e.svg" src="../_images/f1bc2e30cd9e2ea8d2025fd2e410ee96061841d2966a6ef9169c416cca5d662e.svg" /></div>
</div>
<p>Now let’s draw multiple samples and plot them on the same figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">rod</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">rod</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ (m)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T(x)\;(^\circ C)$&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f971571bd73c782e4009d366b629885482255599a6c50f27b2e8b51f4c1bbe16.svg" src="../_images/f971571bd73c782e4009d366b629885482255599a6c50f27b2e8b51f4c1bbe16.svg" /></div>
</div>
<p>Our classes are working as expected. Now let’s use them to do Monte Carlo.</p>
</section>
<section id="uncertainty-propagation-through-the-boundary-value-problem">
<h2>Uncertainty propagation through the boundary value problem<a class="headerlink" href="#uncertainty-propagation-through-the-boundary-value-problem" title="Permalink to this heading">#</a></h2>
<p>We start by generating the data to reuse them later to analyze various quantities of interest.
Writing the data to a file we can reuse later without rerunning the notebook is also a good idea. This is especially useful if we are using computationally expensive simulators.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of samples to take</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># A place to store the results of all simulations</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Loop over samples</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="c1"># Draw a random rod</span>
    <span class="n">rod</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
    <span class="c1"># Evaluate the solver at this rod</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">rod</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Store the data for later use</span>
    <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">y</span>
    
<span class="c1"># Okay, we have the data. Let&#39;s write them to a file in the simplest possible way</span>
<span class="c1"># (using a text format). IF YOU ARE ON GOOGLE COLAB THE FILE IS </span>
<span class="n">data_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;steady_state_heat_N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">.txt&#39;</span>
<span class="c1"># This saves the data:</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">data_filename</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how you can reload the data (this doesn’t require running the code above if you have already done it).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The file to read (MAKE SURE YOU CHANGE THIS IF YOU WNAT TO READ ANOTHER FILE)</span>
<span class="c1"># IF YOU ARE ON GOOGLE COLAB THE FILE </span>
<span class="n">input_filename</span> <span class="o">=</span> <span class="s1">&#39;steady_state_heat_N=1000.txt&#39;</span>
<span class="c1"># This is just a check that the file exists</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_filename</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
        <span class="s1">&#39;File &quot;</span><span class="si">{input_filename}</span><span class="s1">&quot; does not exist.&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;Make sure you run code above with the appropriate parameters&#39;</span>
    <span class="p">)</span>
<span class="c1"># If you reach this point, the file exists. Load it:</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">input_filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loaded data shape: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># Make sure N reflects the correct data set</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded data shape:  (1000, 501)
</pre></div>
</div>
</div>
</div>
<p>And now, we can use the <code class="docutils literal notranslate"><span class="pre">data</span></code> to estimate statistics using Monte Carlo.
Let’s start with the expectation of <span class="math notranslate nohighlight">\(T(x)\)</span> at a single point, say <span class="math notranslate nohighlight">\(x=0.5\)</span>.
That is, we want to estimate <span class="math notranslate nohighlight">\(\mathbb{E}[T(x=0.5)]\)</span> where the expectation is over the random rods.
Here is how we can do it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract only the relevant data</span>
<span class="n">T_middle_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

<span class="c1"># Evaluate the sample average </span>
<span class="n">T_middle_running</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">T_middle_data</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Evaluate the sample average for the squared of T_middle</span>
<span class="n">T_middle2_running</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">T_middle_data</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Evaluate the running average of the variance</span>
<span class="n">sigma2_running</span> <span class="o">=</span> <span class="n">T_middle2_running</span> <span class="o">-</span> <span class="n">T_middle_running</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># Alright, now we have quantified our uncertainty about I for every N</span>
<span class="c1"># from a single MC run. Let&#39;s plot a (about) 95% predictive interval</span>
<span class="c1"># Running lower bound for the predictive interval</span>
<span class="n">T_middle_lower_running</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">T_middle_running</span> 
    <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2_running</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">)</span>
<span class="c1"># Running upper bound for the predictive interval</span>
<span class="n">T_middle_upper_running</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">T_middle_running</span>
    <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2_running</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1"># A common plot for all estimates</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># Shaded area for the interval</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">T_middle_lower_running</span><span class="p">,</span>
    <span class="n">T_middle_upper_running</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span>
<span class="p">)</span>
<span class="c1"># Here is the MC estimate:</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">T_middle_running</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># The true value</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">[(</span><span class="mf">4.0</span> <span class="o">+</span> <span class="mf">400.0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="c1"># and the labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$N$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbb</span><span class="si">{E}</span><span class="s1">[T(x=0.5)]$&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/41979b79dbe2023d3dfb345ec74d0ada566b4ad8e16c06522e9dc5cce19f9205.svg" src="../_images/41979b79dbe2023d3dfb345ec74d0ada566b4ad8e16c06522e9dc5cce19f9205.svg" /></div>
</div>
<p>How many samples must you take for this to be sufficiently converged?
Remember, that in real life you cannot see the red line.
Suppose that we want to ensure an accurate of some small positive <span class="math notranslate nohighlight">\(\epsilon\)</span>.
We can say that we want an <span class="math notranslate nohighlight">\(N\)</span> such that the 95% prediction interval is less wide than <span class="math notranslate nohighlight">\(\epsilon\)</span>.
If we knew the variance <span class="math notranslate nohighlight">\(\sigma^2\)</span> of the random variable, then the interval width (according to CLT) would be approximately:</p>
<div class="math notranslate nohighlight">
\[
\epsilon = 4 \frac{\sigma}{\sqrt{N}}.
\]</div>
<p>So, we want an <span class="math notranslate nohighlight">\(N\)</span> that satisfies:</p>
<div class="math notranslate nohighlight">
\[
N \geq \frac{16\sigma^2}{\epsilon^2}.
\]</div>
<p>Of course, we do not know <span class="math notranslate nohighlight">\(\sigma^2\)</span>.
So, the next best thing we can do is to estimate it as well and then pick <span class="math notranslate nohighlight">\(N\)</span> such that:</p>
<div class="math notranslate nohighlight">
\[
N \geq \frac{16\bar{\sigma}^2}{\epsilon^2}.
\]</div>
<p>Here is an attempt:</p>
<p>bar_sigma = np.sqrt(sigma2_running[-1])
bar_sigma</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bar_sigma2</span> <span class="o">=</span> <span class="n">sigma2_running</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="n">bar_sigma2</span> <span class="o">/</span> <span class="n">epsilon</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;N = &quot;</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N =  30503
</pre></div>
</div>
</div>
</div>
<p>That’s a big number. And it will be bigger if you choose a smaller <span class="math notranslate nohighlight">\(\epsilon\)</span>.
There are ways to deal with this issue.
The most common way to deal with this is to replace the computationally expensive numerical solver with an inexpensive surrogate model.
You build this model using a finite number of input-output pairs from the numerical solver.
Then you use this surrogate model to predict the output for any input.
There many possibilities for the surrogate model: polynomial regression, neural networks, Gaussian processes, etc.
You will be equipped with the knowledge to build these surrogate models by the time you finish this course.</p>
<p>Let us finish by finding the median and a 95% predictive interval for all spatial points:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_025</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_975</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_025</span><span class="p">,</span> <span class="n">mu_975</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="c1"># Let&#39;s take a couple of samples and see if they fall inside:</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">rod</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">rod</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$T(x)$&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/175685b2e125e70e05417ada42ec9d1e3ad2975bb9196c04b77d7356a596f739.svg" src="../_images/175685b2e125e70e05417ada42ec9d1e3ad2975bb9196c04b77d7356a596f739.svg" /></div>
</div>
<section id="questions">
<h3>Questions<a class="headerlink" href="#questions" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Use the data you have collected in <code class="docutils literal notranslate"><span class="pre">data</span></code> to estimate the probability that <span class="math notranslate nohighlight">\(T(x=0.5)\)</span> is greater than <span class="math notranslate nohighlight">\(0.6\)</span>.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lecture10"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="hands-on-10.3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Quantifying Epistemic Uncertainty in Monte Carlo Estimates</p>
      </div>
    </a>
    <a class="right-next"
       href="../principles_of_bi.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Principles of Bayesian Inference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modeling-our-state-of-knowledge-about-the-conductivity-of-the-rod">Modeling our state of knowledge about the conductivity of the rod</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-a-bit-organized-using-python-classes">Getting a bit organized using Python classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-propagation-through-the-boundary-value-problem">Uncertainty propagation through the boundary value problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ilias Bilionis (ibilion[at]purdue.edu)
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>